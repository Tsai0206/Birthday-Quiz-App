// Marvin 24æ­²ç”Ÿæ—¥å•ç­”é¡Œåº«
export const sampleQuestions = [
    // ==== ç¬¬ 1 éšæ®µï¼šåŸºæœ¬é€åˆ†é¡Œ ====
    {
        id: 1,
        question: "Marvin å°±è®€ç§‘ç³»å…¨åæ˜¯ï¼Ÿ(çœ‹æ¸…æ¥šå‘¦)",
        options: [
            "Biomedical Engineering",
            "Biochemical Engineering",
            "BioEnginearing",
            "Biomedical Imagineering"
        ],
        correctAnswer: 0,
        timeLimit: 30,
        points: 0
    },
    {
        id: 2,
        question: "Marvin äººç”Ÿä¸­åœ¨å“ªå€‹åŸå¸‚ã€Œç”Ÿæ´»æœ€ä¹…ã€ï¼Ÿ",
        options: ["å»£æ±", "å½°åŒ–", "å°å—", "å°ä¸­"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 3,
        question: "Marvin ä¸ç†è§£å“ªç¨®èªè¨€ï¼Ÿ",
        options: ["è‹±èª", "æ—¥èª", "ç²µèª", "å°èª"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 4,
        question: "Marvin ä¼¼ä¹è·³éèˆï¼Œè«‹å•èˆé¢¨æ˜¯ï¼Ÿ",
        options: ["å»£å ´èˆ", "Hip Hop", "High Heels", "Popping"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 5,
        question: "Marvin å…„å¼Ÿå§Šå¦¹å¹´é½¡æ¯”ä»–ï¼Ÿ",
        options: [
            "å¼Ÿå¼Ÿå°ä¸€æ­²ï¼Œå¦¹å¦¹å°ä¹æ­²",
            "å¼Ÿå¼Ÿå°ä¸€æ­²ï¼Œå¦¹å¦¹å°äº”æ­²",
            "å“¥å“¥å¤§ä¸€æ­²ï¼Œå¦¹å¦¹å°äº”æ­²",
            "å“¥å“¥å¤§ä¸€æ­²ï¼Œæ²’æœ‰å¦¹å¦¹"
        ],
        correctAnswer: 0,
        timeLimit: 30,
        points: 0
    },
    {
        id: 6,
        question: "Marvin æœ€æ„›ç©¿ä»€éº¼è¡£æœï¼Ÿ",
        options: ["Skinny", "Oversize", "8+9", "Nudist"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 7,
        question: "Marvin è¢«åˆ¥äººèªªé•·å¾—åƒå“ªä½äººï¼Ÿ",
        options: ["è¨±å…‰æ¼¢", "é™¶å–†", "è¶™é›¨å‡¡", "å…©æ´¥å‹˜å‰"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },

    // ==== ç¬¬ 2 éšæ®µï¼šç”Ÿæ´»ç¿’æ…£èˆ‡æŠ€èƒ½ ====
    {
        id: 8,
        question: "Marvin å¹³å‡éƒ½åœ¨å¹¾é»ã€Œå…¥ç¡ã€ï¼Ÿ",
        options: [
            "10:00 PM - 12:00 AM",
            "12:00 AM - 2:00 AM",
            "2:00 AM - 4:00 AM",
            "4:00 AM - 6:00 AM"
        ],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 9,
        question: "Marvin å»ä¸Šèª²çš„æ™‚å€™æœ€è¨å­ï¼Ÿ",
        options: [
            "éŒ¯éå…¬è»Šä¸Šèª²é²åˆ°",
            "æ›¸åŒ…å¤ªé‡è…°é…¸èƒŒç—›",
            "æ ¹æœ¬å°±ä¸æƒ³ä¸Šå¯¦é«”èª²",
            "B'moreçˆ›è·¯æšˆè»Šæšˆçˆ›"
        ],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 10,
        question: "è‡ªå·±ä¸€å€‹äººçš„æ™‚å€™ï¼ŒMarvin æœ€å¸¸ç…®ä»€éº¼ï¼Ÿ",
        options: ["éº»å©†è±†è…", "æ³¡éºµåŠ è›‹", "é¦¬éˆ´è–¯ç‡‰è‚‰", "ç‰ç±³æ¿ƒæ¹¯"],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 11,
        question: "å±å±(æˆ‘çš„è²“)ç‚ºç”šéº¼å«å±å±",
        options: [
            "ä»–å°æ™‚å€™å±è‚¡ç‰¹åˆ¥è‚¥",
            "ä»–å°æ™‚å€™å¾ˆæ„›ç¡åœ¨æˆ‘å±è‚¡æ—é‚Š",
            "é ˜é¤Šå‰å°±å«å±å±äº†æ²’æœ‰æ”¹",
            "å¥¹å°æ™‚å€™å–œæ­¡è¢«æ‹å±å±"
        ],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 12,
        question: "èº«ç‚ºå°ç£äººï¼ŒMarvin æœ€æ„›çš„é£²æ–™æ˜¯ï¼Ÿ",
        options: ["çç å¥¶èŒ¶", "èŠ­æ¨‚ç¶ èŒ¶", "å¯å£å¯æ¨‚", "è±†æ¼¿ç´…èŒ¶"],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 13,
        question: "Marvin åœ¨å“ªæ¬¾éŠæˆ²ä¸Šèª²é‡‘æœ€å¤šï¼Ÿ",
        options: ["Fortnite", "League of Legends", "Valorant", "Marvel Snap"],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 14,
        question: "ä»¥ä¸‹ä»€éº¼äº‹æœƒè®“ Marvin å¿ƒè£¡æœ€ç…©èºï¼Ÿ",
        options: [
            "å±å±åŠå¤œäº”é»åµæˆ‘ç¡è¦º",
            "é‡åˆ°è¶…é›·Projectçµ„å“¡",
            "ç´„åƒé£¯æœ‹å‹é²åˆ°ä¸€å°æ™‚",
            "äº‹æƒ…è·Ÿé æœŸè¨ˆç•«ä¸ä¸€æ¨£"
        ],
        correctAnswer: 3,
        timeLimit: 30,
        points: 0
    },

    // ==== ç¬¬ 3 éšæ®µï¼šè…¦æ´èˆ‡æ¶ˆè²» ====
    {
        id: 15,
        question: "Marvin è²·Groceriesçš„ç¿’æ…£æ˜¯ï¼Ÿ",
        options: ["æ–¤æ–¤è¨ˆè¼ƒ", "ä¸€æ¬¡å›¤å¤ ", "æœ‰æ©Ÿé£Ÿå“", "é¸æ“‡å›°é›£"],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 16,
        question: "Marvin æœ€å–œæ­¡ä»¥ä¸‹å“ªä½æ­Œæ‰‹",
        options: [
            "XXXTentacion",
            "Kendrick Lamar",
            "Don Toliver",
            "Drake"
        ],
        correctAnswer: 0,
        timeLimit: 30,
        points: 0
    },
    {
        id: 17,
        question: "Marvin æœƒé¸ä¸€å€‹è¶…èƒ½åŠ›ï¼Œçµ•å°æœƒé¸ï¼Ÿ",
        options: ["éš±èº«è¡“", "è®€å¿ƒè¡“", "ç¬é–“ç§»å‹•", "åŠ›å¤§ç„¡çª®"],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 18,
        question: "é€™å€‹å•ç­”ç¶²ç«™ï¼ŒMarvin èŠ±äº†å¤šä¹…åšå‡ºä¾†(w/ Claude Code)ï¼Ÿ",
        options: [
            "1 week",
            "He copied and stole it from others",
            "1 day",
            "3 days"
        ],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 19,
        question: "Marvin æ˜¯ç”šéº¼çš„å¿ å¯¦ç²‰çµ²?",
        options: [
            "æ—¥æœ¬AVå¥³å„ª",
            "NMIXX",
            "MARVEL Movies",
            "DC Films"
        ],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },

    // ==== ç¬¬ 4 éšæ®µï¼šæäº‹èˆ‡çˆ†æ–™ ====
    {
        id: 20,
        question: "å–é†‰é…’çš„ Marvin æœƒè®Šæˆï¼Ÿ",
        options: [
            "Sleep/Play dead",
            "English Native Speaker",
            "Become a Psychopath",
            "Never drunk before"
        ],
        correctAnswer: 0,
        timeLimit: 30,
        points: 0
    },
    {
        id: 21,
        question: "æœ€ç¬¦åˆæˆ‘è‡ªå‚³çš„æ›¸å",
        options: [
            "ã€Šè«–å¦‚ä½•ä¸€äº‹ç„¡æˆï¼Œå»ä¾ç„¶é«˜åº¦è‡ªä¿¡ã€‹",
            "ã€Šå¾å…¥é–€åˆ°æ”¾æ£„ï¼šåŠé€”è€Œå»¢çš„ 100 ä»¶äº‹ã€‹",
            "ã€Šæˆ‘è²·çš„ä¸æ˜¯å»¢ç‰©ï¼Œæ˜¯ç•¶ä¸‹çš„å¿«æ¨‚ã€‹",
            "ã€Šæˆ‘ä¸‹æ¬¡ä¸€å®šæº–æ™‚ã€‹"
        ],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 22,
        question: "ä¸‹åˆ—é—œæ–¼ Marvin çš„æ•˜è¿°ï¼Œå“ªä¸€å€‹æ˜¯çœŸï¼Ÿ",
        options: [
            "æˆ‘å…¶å¯¦è¨å­è²“å’ª",
            "æˆ‘å…¶å¯¦æ˜¯Gay",
            "æˆ‘å…¶å¯¦æƒ³ç•¶é»‘äºº",
            "æˆ‘å…¶å¯¦ä¼‘å­¸é"
        ],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },
    {
        id: 23,
        question: "Marvin ç‚ºç”šéº¼å¤±çœ æ˜¯å› ç‚º?",
        options: [
            "Super horny",
            "Can't stop thinking",
            "Non-stop Instagram Reels",
            "No special reason"
        ],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },
    {
        id: 24,
        question: "åœ¨ Baltimore ç”Ÿæ´»éå¾Œï¼ŒMarvin é€²æ­¥æœ€å¤šæŠ€èƒ½æ˜¯ï¼Ÿ",
        options: [
            "å¾ˆæœƒSmall talk",
            "æ±ä¸æ€•è¥¿ä¸æ€•",
            "è½æ‡‚ Baltimore è…”èª¿",
            "å£é½’æ¸…æ™° æœƒå€åˆ†æ²èˆŒéŸ³äº†"
        ],
        correctAnswer: 1,
        timeLimit: 30,
        points: 0
    },

    // ==== ç¬¬ 5 éšæ®µï¼šæœ€çµ‚å¤§ç ====
    {
        id: 25,
        question: "Marvin æœ€è¿‘ä¸€ç­†ã€Œå¤§é¡æ¶ˆè²»ã€æ˜¯ç‚ºäº†ä»€éº¼",
        options: [
            "AI tokens å¹´è²»",
            "éŠæˆ²èª²é‡‘è²·é€ å‹",
            "DCè„«å£ç§€é–€ç¥¨",
            "å¢¨è¥¿å“¥æ©Ÿç¥¨"
        ],
        correctAnswer: 2,
        timeLimit: 30,
        points: 0
    },

    // ==== ç‰¹åˆ¥é‚€è«‹ ====
    {
        id: 26,
        question: "3/1 ç¦®æ‹œæ—¥æ™šä¸Š7é» MATT RIFE è„«å£ç§€ä¸–ç•Œå·¡è¿´æƒ³å»å—?",
        options: ["æ˜¯", "å¦", "çœ‹çœ‹å½±ç‰‡å†æ±ºå®š"],
        correctAnswer: 0,
        timeLimit: 60,
        points: 0,
        isSpecial: true,
        videoLinks: [
            "https://youtu.be/mvUW8KGolMI?si=OwRht4wDGUh1NmqL",
            "https://youtu.be/ZSIfh5GAx-k?si=2mjHIeKeXszFTChw"
        ],
        imageUrl: "/mattrife.png"
    }
];

// Generate random 6-digit room code
export function generateRoomCode(): string {
    return Math.floor(100000 + Math.random() * 900000).toString();
}

// Shuffle array (Fisher-Yates algorithm)
export function shuffleArray<T>(array: T[]): T[] {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Calculate points based on time taken
export function calculatePoints(timeTaken: number, timeLimit: number): number {
    // Max 1000 points for instant answer, decreases with time
    const speedBonus = Math.floor((timeLimit - timeTaken) / timeLimit * 1000);
    return Math.max(0, speedBonus);
}

// Avatar options (20+ fun emojis)
export const avatarOptions = [
    "ğŸ˜€", "ğŸ˜", "ğŸ¤“", "ğŸ¥³", "ğŸ¤©", "ğŸ˜‡",
    "ğŸ¤—", "ğŸ¥°", "ğŸ˜Š", "ğŸ™ƒ", "ğŸ˜", "ğŸ¤ª",
    "ğŸ¤¡", "ğŸ‘»", "ğŸ‘½", "ğŸ¤–", "ğŸ’©", "ğŸ¦„",
    "ğŸ¶", "ğŸ±", "ğŸ¼", "ğŸ¦Š", "ğŸ¸", "ğŸ¦",
    "ğŸŒŸ", "âš¡", "ğŸ”¥", "ğŸ’", "ğŸ­", "ğŸª"
];

// ==========================================
// ğŸ”’ ANTI-CHEATING: Option Shuffle Database Functions
// ==========================================

/**
 * Generate and store shuffled option order for a specific player and question
 * This ensures each player sees options in a different order (anti-cheating)
 * and the order persists across page reloads.
 *
 * @param supabase - Supabase client instance
 * @param playerId - UUID of the player
 * @param questionIndex - Index of the current question
 * @param optionsCount - Number of options for this question
 * @returns Array of shuffled indices (e.g., [2, 0, 3, 1])
 */
export async function generatePlayerShuffle(
    supabase: any,
    playerId: string,
    questionIndex: number,
    optionsCount: number
): Promise<number[]> {
    // Check if shuffle already exists (for page reload scenarios)
    const { data: existing } = await supabase
        .from('option_shuffles')
        .select('shuffled_order')
        .eq('player_id', playerId)
        .eq('question_index', questionIndex)
        .single();

    if (existing) {
        return existing.shuffled_order;
    }

    // Generate new shuffle using Fisher-Yates algorithm
    const indices = Array.from({ length: optionsCount }, (_, i) => i);
    const shuffled = shuffleArray(indices);

    // Store in database
    await supabase
        .from('option_shuffles')
        .insert({
            player_id: playerId,
            question_index: questionIndex,
            shuffled_order: shuffled
        });

    return shuffled;
}

/**
 * Retrieve the shuffled option order for a player and question
 * Used when player reloads the page mid-game.
 *
 * @param supabase - Supabase client instance
 * @param playerId - UUID of the player
 * @param questionIndex - Index of the current question
 * @returns Array of shuffled indices, or null if not found
 */
export async function getPlayerShuffle(
    supabase: any,
    playerId: string,
    questionIndex: number
): Promise<number[] | null> {
    const { data } = await supabase
        .from('option_shuffles')
        .select('shuffled_order')
        .eq('player_id', playerId)
        .eq('question_index', questionIndex)
        .single();

    return data?.shuffled_order || null;
}

/**
 * Apply the shuffle to the options array
 * Converts [A, B, C, D] with shuffle [2, 0, 3, 1] â†’ [C, A, D, B]
 *
 * @param options - Original options array
 * @param shuffledIndices - Shuffled indices from database
 * @returns Shuffled options array
 */
export function applyShuffleToOptions(options: string[], shuffledIndices: number[]): string[] {
    return shuffledIndices.map(index => options[index]);
}

/**
 * Validate player's answer using the original option index
 * Player selected displayIndex 2, but we need to check the original index.
 *
 * @param displayIndex - Index of option as displayed to player (0-3)
 * @param shuffledIndices - The shuffle order from database
 * @param correctAnswer - The original correct answer index
 * @returns true if correct, false otherwise
 */
export function validateShuffledAnswer(
    displayIndex: number,
    shuffledIndices: number[],
    correctAnswer: number
): boolean {
    const originalIndex = shuffledIndices[displayIndex];
    return originalIndex === correctAnswer;
}
